#!/bin/bash

#DEBHELPER#

# Disable last login message after user SSHs in
if grep -q -E "^?PrintLastLog" /etc/ssh/sshd_config; then
    sudo sed -i "s/^#\?PrintLastLog.*/PrintLastLog no/" /etc/ssh/sshd_config
else
    echo "PrintLastLog no" >> /etc/ssh/sshd_config
fi

# Add Grafana repository
if [ ! -f /etc/apt/sources.list.d/grafana.list ]; then
    echo "Adding grafana repository"
    wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
    echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
fi

# Add InfluxData repository (influxdb, influxdb2, telegraf, chronograf)
if [ ! -f /etc/apt/sources.list.d/influxdb.list ]; then
    curl https://repos.influxdata.com/influxdata-archive.key | gpg --dearmor | sudo tee /usr/share/keyrings/influxdb-archive-keyring.gpg >/dev/null
    echo "deb [signed-by=/usr/share/keyrings/influxdb-archive-keyring.gpg] https://repos.influxdata.com/debian $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/influxdb.list
fi

apt update >/dev/null 